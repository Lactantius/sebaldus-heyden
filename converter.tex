%LuaTeX

\startxmlsetups xml:corderius:*
  \xmlsetsetup{\xmldocument}{*}{-}
  \xmlsetsetup{\xmldocument}{TEI.2|text|body|castList|castItem|sp|speaker|foreign|p|head|q}{xml:corderius:*}

  \xmlsetsetup{\xmldocument}{div[@type='colloquia']}{xml:corderius:colloquia}
  \xmlsetsetup{\xmldocument}{div[@type='colloquium']}{xml:corderius:colloquium}
  \xmlsetsetup{\xmldocument}{div[@type='book']}{xml:corderius:liber}

  \xmlsetsetup{\xmldocument}{div[@type='book']/head}{xml:corderius:booktitle}
\stopxmlsetups

\xmlregisterdocumentsetup{corderius}{xml:corderius:*}

\startxmlsetups{xml:corderius:TEI.2}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:text}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:body}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:colloquia}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:liber}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:booktitle}
  \startchapter[
    title={\xmlflush{#1}}
    ]
  \stopchapter
\stopxmlsetups

\startxmlsetups{xml:corderius:colloquium}
  \startchapter[
    title={\xmlfirst{#1}{/head}}
    ]
    \xmlflush{#1}
  \stopchapter
\stopxmlsetups

\startxmlsetups{xml:corderius:head}
  \xmlflush{#1}
\stopxmlsetups

\setuphead[chapter][
  page=no,
  number=no,
]

\startxmlsetups{xml:corderius:castList}
  \xmlflush{#1}\endgraf
\stopxmlsetups

\startxmlsetups{xml:corderius:castItem}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:sp}
  \xmlflush{#1}\endgraf
\stopxmlsetups

\startxmlsetups{xml:corderius:speaker}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:p}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:foreign}
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups{xml:corderius:q}
  \xmlflush{#1}
\stopxmlsetups

\starttext

  \xmlprocessfile{corderius}{liber_i.xml}{}

\stoptext
